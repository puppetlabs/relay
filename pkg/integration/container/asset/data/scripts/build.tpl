#!/usr/bin/env bash

# This file is automatically generated by the Nebula SDK. DO NOT EDIT.

set -euo pipefail

#
# Commands
#

DOCKER="${DOCKER:-docker}"

#
# Variables
#

DOCKER_ARGS="${DOCKER_ARGS:-}"
DOCKER_BUILD_ARGS="${DOCKER_BUILD_ARGS:-}"

#
#
#

declare -a TAGS

while getopts ':t:' OPTNAME; do
  case "${OPTNAME}" in
  t)
    TAGS+=( "${OPTARG}" )
    ;;
  \?)
    echo "Unrecognized option: -${OPTARG}" >&2
    exit 1
    ;;
  esac
done

shift $(( OPTIND - 1 ))

{{ range .Images }}
$DOCKER $DOCKER_ARGS build $DOCKER_BUILD_ARGS --tag {{ .Ref }} --file {{ .Filename }} .
{{- end }}

for TAG in ${TAGS[@]+"${TAGS[@]}"}; do
{{- range .Images }}
  $DOCKER $DOCKER_ARGS tag {{ .Ref }} "{{ .Name }}:${TAG}{{ .TagSuffix }}" && \
    printf "# Tagged %s:%s\n" {{ .Name }} "${TAG}{{ .TagSuffix }}"
{{- end }}
done
